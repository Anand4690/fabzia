<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Slot Booking - Fabzia Turf</title>

    <!-- Utility CSS -->
    <link rel="stylesheet" href="utility.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'text-heading': 'var(--text-heading)',
                        'text-body': 'var(--text-body)',
                        'text-label': 'var(--black-700)',
                        'text-inverse-heading': 'var(--white)',
                        'brand-green': 'var(--green)',
                        'brand-green-dark': 'var(--green-dark)',
                        'bg-page': 'var(--white-pure)',
                        'bg-muted': 'var(--bg-light)',
                        'border-light': 'var(--border-light)',
                        'container-border': 'var(--bg-container)',
                        'partial-yellow': '#EAB308',
                        'partial-yellow-bg': '#FEFCE8',
                    },
                    fontFamily: {
                        'lato': ['Lato', 'sans-serif'],
                    },
                    maxWidth: {
                        'mobile': '430px',
                    },
                }
            }
        }
    </script>

    <style>
        /* Hide scrollbar for Chrome, Safari, Opera */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge, Firefox */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-light);
        }

        /* ── Modal / Bottom Sheet Transitions ── */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            z-index: 80;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-width: 430px;
            z-index: 90;
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px 16px 0 0;
            background: var(--white-pure);
            box-shadow: 0 -8px 30px rgba(0,0,0,0.12);
        }
        .bottom-sheet.active {
            transform: translateX(-50%) translateY(0);
        }

        /* ── Slot Card ── */
        .slot-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: var(--s-8px);
            height: 70px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            font-family: 'Lato', sans-serif;
        }
        .slot-card:active:not(:disabled) {
            transform: scale(0.97);
        }
        .slot-card.available {
            border-color: var(--border-mid);
            color: var(--text-heading);
            background: var(--white-pure);
        }
        .slot-card.available:hover {
            border-color: var(--green);
        }
        .slot-card.selected {
            border-color: var(--green);
            background: var(--green);
            color: var(--white-pure);
        }
        .slot-card.partial {
            border-color: #EAB308;
            background: #FEFCE8;
            color: var(--text-heading);
        }
        .slot-card.disabled {
            border-color: var(--border-light);
            background: var(--bg-light);
            color: var(--black-700);
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ── Calendar Day Button ── */
        .day-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            min-width: 50px;
            padding: 6px 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            background: transparent;
            position: relative;
        }
        .day-btn .day-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--black-300);
        }
        .day-btn .day-date {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-heading);
            line-height: 1.4;
        }
        .day-btn.selected .day-name {
            color: var(--green-dark);
        }
        .day-btn.selected .day-date {
            background: var(--green);
            color: var(--white-pure);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .day-btn.today::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--green);
        }
        .day-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .day-btn:disabled .day-name,
        .day-btn:disabled .day-date {
            color: var(--black-700);
        }

        /* ── Squad Size Pill ── */
        .squad-pill {
            padding: 4px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid #B2B2B2;
            background: var(--white-pure);
            color: var(--text-heading);
            cursor: pointer;
            transition: all 0.15s ease;
            white-space: nowrap;
        }
        .squad-pill.active {
            background: var(--green);
            color: var(--white-pure);
            border-color: var(--green);
        }

        /* ── Time Filter Pill ── */
        .filter-pill {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 400;
            border: 1px solid #B2B2B2;
            background: var(--white-pure);
            color: var(--text-heading);
            cursor: pointer;
            transition: all 0.15s ease;
            white-space: nowrap;
        }
        .filter-pill.active {
            background: var(--green);
            color: var(--white-pure);
            border-color: var(--green);
            font-weight: 500;
        }

        /* ── Checkbox Custom ── */
        .pref-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #B2B2B2;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .pref-checkbox.checked {
            background: var(--green);
            border-color: var(--green);
        }
        .pref-checkbox.checked::after {
            content: '';
            width: 6px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            margin-bottom: 2px;
        }

        /* ── Pay button ── */
        .pay-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--s-8px);
            background-color: var(--green-dark);
            color: var(--white-pure);
            font-weight: 600;
            font-size: var(--m-16px);
            border-radius: var(--s-8px);
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s ease;
            flex: 1;
            max-width: 201px;
        }
        .pay-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>

    <!-- ════════════════════════════════════════════════════════════════ -->
    <!-- MAIN MOBILE CONTAINER                                          -->
    <!-- ════════════════════════════════════════════════════════════════ -->
    <div id="app" class="w-full max-w-mobile mx-auto bg-bg-page min-h-screen flex flex-col relative" style="box-shadow: 0 0 40px rgba(0,0,0,0.08);">

        <!-- ── Top Navigation ── -->
        <div class="sticky top-0 z-50 bg-white border-b px-1 py-2 flex items-center gap-2" style="border-color: var(--bg-container);">
            <button onclick="window.history.back()" class="w-12 h-12 flex items-center justify-center rounded-full" style="transition: background 0.15s;" onmouseover="this.style.background='var(--bg-light)'" onmouseout="this.style.background='transparent'">
                <i data-lucide="chevron-left" class="w-6 h-6" style="color: var(--text-heading);"></i>
            </button>
            <div class="flex-1 min-w-0">
                <h1 class="text-lg font-normal leading-7 truncate" style="color: var(--text-heading);">The Multisports Turf</h1>
                <p class="text-xs leading-tight truncate" style="color: var(--text-body);">Manpada, Thane west , Mumbai</p>
            </div>
        </div>

        <!-- ── Month Display ── -->
        <div class="sticky top-[56px] z-40 bg-white py-2 text-center border-b" style="border-color: var(--bg-container);">
            <span id="month-display" class="text-sm font-semibold capitalize" style="color: var(--text-heading);">December, 2025</span>
        </div>

        <!-- ── Calendar Strip ── -->
        <div class="sticky top-[97px] z-40 bg-white py-2 px-2 flex items-center gap-1" style="min-height: 74px;">
            <button onclick="scrollCalendar(-1)" class="flex-shrink-0 w-8 flex items-center justify-center">
                <i data-lucide="chevron-left" class="w-5 h-5" style="color: var(--text-heading);" stroke-width="1.5"></i>
            </button>
            <div id="calendar-strip" class="flex-1 flex gap-1 overflow-x-auto scrollbar-hide">
                <!-- Days injected by JS -->
            </div>
            <button onclick="scrollCalendar(1)" class="flex-shrink-0 w-8 flex items-center justify-center">
                <i data-lucide="chevron-right" class="w-5 h-5" style="color: var(--text-heading);" stroke-width="1.5"></i>
            </button>
        </div>

        <!-- ── Squad Size Selector ── -->
        <div class="sticky top-[170px] z-30 border-b" style="background: #FAFAFA; border-color: var(--bg-container);">
            <button onclick="toggleSquadPanel()" class="w-full px-4 py-3 flex items-center justify-between" style="transition: background 0.15s;">
                <div class="flex items-center gap-2">
                    <span class="text-sm font-medium whitespace-nowrap" style="color: var(--text-heading);">Select Squad Size</span>
                    <span id="squad-badge" class="px-4 py-1 rounded-2xl text-xs border" style="border-color: #B2B2B2; color: var(--green-dark);">5v5</span>
                </div>
                <div class="flex items-center gap-2">
                    <span id="preview-link" onclick="event.stopPropagation(); openModal('preview')" class="text-xs font-medium" style="color: var(--green-dark); cursor: pointer;">Preview</span>
                    <i id="squad-chevron" data-lucide="chevron-down" class="w-4 h-4 flex-shrink-0" stroke-width="1.5"></i>
                </div>
            </button>

            <!-- Squad Options Panel (hidden by default) -->
            <div id="squad-panel" class="hidden px-4 pb-4 pt-2 bg-white border-b" style="border-color: var(--bg-container);">
                <div id="squad-options" class="flex flex-wrap gap-2">
                    <!-- Squad pills injected by JS -->
                </div>
            </div>
        </div>

        <!-- ── Slot Grid Header with Filter ── -->
        <div class="sticky top-[218px] z-20 bg-white px-4 py-3 flex items-center justify-between" style="box-shadow: 0 2px 4px rgba(0,0,0,0.06);">
            <div class="flex items-center gap-3">
                <!-- Legend -->
                <div class="flex items-center gap-1.5">
                    <div class="w-3.5 h-3.5 rounded" style="border: 2px solid var(--border-mid);"></div>
                    <span class="text-[10px]" style="color: var(--text-body);">Available</span>
                </div>
                <div class="flex items-center gap-1.5">
                    <div class="w-3.5 h-3.5 rounded" style="background: #EAB308;"></div>
                    <span class="text-[10px]" style="color: var(--text-body);">Partial</span>
                </div>
                <div class="flex items-center gap-1.5">
                    <div class="w-3.5 h-3.5 rounded" style="background: var(--bg-light); border: 1px solid var(--border-mid);"></div>
                    <span class="text-[10px]" style="color: var(--text-body);">Sold</span>
                </div>
            </div>
            <button onclick="openModal('preferredTime')" class="flex items-center gap-1 px-3 py-1.5 rounded-full border text-xs" style="border-color: #B2B2B2; color: var(--text-heading); transition: background 0.15s;" onmouseover="this.style.background='var(--bg-light)'" onmouseout="this.style.background='transparent'">
                <i data-lucide="sliders-horizontal" class="w-3.5 h-3.5"></i>
                <span>Filter</span>
            </button>
        </div>

        <!-- ── Main Scrollable Slots Area ── -->
        <div class="flex-1 overflow-y-auto px-4 py-4">
            <div id="slots-grid" class="grid grid-cols-2 gap-3 pb-4">
                <!-- Slot cards injected by JS -->
            </div>

            <!-- Available in Other Half Section -->
            <div id="other-half-section" class="hidden mt-2 mb-4 px-3 py-3 rounded-lg" style="background: #FEFCE8; border: 1px solid #EAB308;">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded" style="background: #EAB308;"></div>
                        <span class="text-xs font-normal" style="color: var(--text-body);">Available in other Half</span>
                    </div>
                    <button class="text-xs font-medium" style="color: var(--green-dark); transition: opacity 0.15s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">
                        View →
                    </button>
                </div>
            </div>
        </div>

        <!-- ── Bottom Navigation Bar ── -->
        <div id="bottom-bar" class="sticky bottom-0 z-50 bg-white border-t px-4 py-3 flex items-center justify-between gap-4" style="border-color: var(--bg-container); box-shadow: 0 -4px 12px rgba(0,0,0,0.06);">
            <button onclick="openModal('confirmSlot')" class="flex items-center gap-1" style="color: var(--text-heading); transition: opacity 0.15s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">
                <span id="slot-count" class="font-semibold text-base">0 Slots</span>
                <i data-lucide="chevron-up" class="w-4 h-4"></i>
            </button>
            <button onclick="handlePay()" class="pay-btn">
                <span>Pay</span>
                <span id="total-price">₹0</span>
            </button>
        </div>

    </div>
    <!-- END MAIN CONTAINER -->


    <!-- ════════════════════════════════════════════════════════════════ -->
    <!-- MODALS / BOTTOM SHEETS                                         -->
    <!-- ════════════════════════════════════════════════════════════════ -->

    <!-- Shared Overlay -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()"></div>

    <!-- ── 1. Preview Modal ── -->
    <div id="preview-sheet" class="bottom-sheet">
        <div class="px-4 py-3 flex items-center justify-between border-b" style="border-color: var(--bg-container); background: var(--bg-light); border-radius: 16px 16px 0 0;">
            <span class="text-sm font-semibold" style="color: var(--text-heading);">Preview</span>
            <button onclick="closeAllModals()" class="w-8 h-8 flex items-center justify-center rounded-full" style="transition: background 0.15s;" onmouseover="this.style.background='var(--bg-container)'" onmouseout="this.style.background='transparent'">
                <i data-lucide="x" class="w-5 h-5" style="color: var(--text-heading);"></i>
            </button>
        </div>
        <div class="px-4 py-6">
            <!-- Turf Mini Pitch -->
            <div class="relative w-full h-48 rounded-lg overflow-hidden mx-auto" style="max-width: 280px; background: var(--green-success); border: 2px solid #15803d;">
                <!-- Field lines -->
                <div class="absolute inset-3 border border-white/40 rounded-sm"></div>
                <div class="absolute top-1/2 left-3 right-3 h-px bg-white/40 -translate-y-1/2"></div>
                <div class="absolute top-1/2 left-1/2 w-12 h-12 -translate-x-1/2 -translate-y-1/2 border border-white/40 rounded-full"></div>
                <div class="absolute top-3 left-1/2 -translate-x-1/2 w-12 h-4 border border-white/40 border-t-0 bg-white/10"></div>
                <div class="absolute bottom-3 left-1/2 -translate-x-1/2 w-12 h-4 border border-white/40 border-b-0 bg-white/10"></div>
                <!-- Highlight Overlay -->
                <div id="preview-highlight" class="absolute bg-black/20 backdrop-blur-sm border-2 border-white transition-all duration-500 ease-out z-20 flex items-center justify-center text-xs font-bold text-white tracking-wider uppercase rounded-sm" style="top:0;left:0;width:100%;height:100%;">
                    <div class="bg-black/15 px-3 py-1 rounded backdrop-blur-md">Full Turf</div>
                </div>
            </div>
            <p class="text-center text-sm mt-4" style="color: var(--text-body);">
                This shows your selected turf area based on squad size.
            </p>
        </div>
    </div>

    <!-- ── 2. Confirm Slot Modal ── -->
    <div id="confirmSlot-sheet" class="bottom-sheet">
        <div class="px-4 py-3 flex items-center justify-between border-b" style="border-color: var(--bg-container); background: var(--bg-light); border-radius: 16px 16px 0 0;">
            <span class="text-sm font-semibold" style="color: var(--text-heading);">Confirm Your Slot</span>
            <button onclick="closeAllModals()" class="w-8 h-8 flex items-center justify-center rounded-full" style="transition: background 0.15s;" onmouseover="this.style.background='var(--bg-container)'" onmouseout="this.style.background='transparent'">
                <i data-lucide="x" class="w-5 h-5" style="color: var(--text-heading);"></i>
            </button>
        </div>
        <div id="confirm-slots-list" class="max-h-60 overflow-y-auto">
            <!-- Confirmed slot rows injected by JS -->
        </div>
        <div class="px-4 py-4">
            <button onclick="closeAllModals()" class="w-full py-2.5 rounded-lg font-semibold text-base text-center" style="background: var(--green-dark); color: var(--white-pure); transition: opacity 0.2s;" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                Close
            </button>
        </div>
    </div>

    <!-- ── 3. Preferred Time Modal ── -->
    <div id="preferredTime-sheet" class="bottom-sheet">
        <div class="px-4 py-3 flex items-center justify-between border-b" style="border-color: var(--bg-container); background: var(--bg-light); border-radius: 16px 16px 0 0;">
            <span class="text-sm font-semibold" style="color: var(--text-heading);">Preferred Time</span>
            <button onclick="closeAllModals()" class="w-8 h-8 flex items-center justify-center rounded-full" style="transition: background 0.15s;" onmouseover="this.style.background='var(--bg-container)'" onmouseout="this.style.background='transparent'">
                <i data-lucide="x" class="w-5 h-5" style="color: var(--text-heading);"></i>
            </button>
        </div>
        <div class="px-4 py-4">
            <div id="pref-time-options" class="flex flex-col gap-3">
                <!-- Checkboxes injected by JS -->
            </div>
            <button onclick="applyPreferredTime()" class="w-full mt-6 py-2.5 rounded-lg font-semibold text-base text-center" style="background: var(--green-dark); color: var(--white-pure); transition: opacity 0.2s;" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                Apply
            </button>
        </div>
    </div>


    <!-- ════════════════════════════════════════════════════════════════ -->
    <!-- JAVASCRIPT                                                      -->
    <!-- ════════════════════════════════════════════════════════════════ -->
    <script>
        // ─── Data ────────────────────────────────────────────────────
        const VENUE = {
            name: "The Multisports Turf",
            address: "Manpada, Thane west , Mumbai",
            month: "December",
            year: 2025,
        };

        const SQUAD_SIZES = ["5v5", "7v7", "8v8", "11v11"];

        const PREFERRED_TIMES = [
            { label: "Morning", range: "6:00 AM – 12:00 PM" },
            { label: "Afternoon", range: "12:00 PM – 5:00 PM" },
            { label: "Evening", range: "5:00 PM – 10:00 PM" },
        ];

        // Generate 30 days from today
        function generateDays() {
            const days = [];
            const today = new Date(2025, 11, 10); // Dec 10, 2025
            const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            for (let i = 0; i < 30; i++) {
                const d = new Date(today);
                d.setDate(today.getDate() + i);
                days.push({
                    dayName: dayNames[d.getDay()],
                    date: d.getDate(),
                    fullDate: `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`,
                    isToday: i === 0,
                });
            }
            return days;
        }

        const SLOTS = [
            { id: "slot1",  startTime: "16:00", endTime: "16:30", price: 750, state: "available" },
            { id: "slot2",  startTime: "16:30", endTime: "17:00", price: 750, state: "available" },
            { id: "slot3",  startTime: "17:00", endTime: "17:30", price: 750, state: "available" },
            { id: "slot4",  startTime: "17:30", endTime: "18:00", price: 750, state: "available" },
            { id: "slot5",  startTime: "18:00", endTime: "18:30", price: 750, state: "available" },
            { id: "slot6",  startTime: "18:30", endTime: "19:00", price: 750, state: "available" },
            { id: "slot7",  startTime: "19:00", endTime: "19:30", price: 750, state: "available" },
            { id: "slot8",  startTime: "19:30", endTime: "20:00", price: 750, state: "partial"   },
            { id: "slot9",  startTime: "20:00", endTime: "20:30", price: 750, state: "available" },
            { id: "slot10", startTime: "20:30", endTime: "21:00", price: 750, state: "disabled"  },
        ];

        // ─── State ───────────────────────────────────────────────────
        const calendarDays = generateDays();
        let selectedDate = calendarDays[0].fullDate;
        let selectedSquadSize = "5v5";
        let selectedSlots = [];       // array of slot IDs
        let isSquadPanelOpen = false;
        let preferredTimeSelections = [];  // e.g. ["Morning", "Evening"]

        // ─── Render: Calendar ────────────────────────────────────────
        function renderCalendar() {
            const container = document.getElementById('calendar-strip');
            container.innerHTML = '';

            calendarDays.forEach(day => {
                const btn = document.createElement('button');
                const isSelected = day.fullDate === selectedDate;
                btn.className = 'day-btn' + (isSelected ? ' selected' : '') + (day.isToday ? ' today' : '');
                btn.onclick = () => selectDate(day.fullDate);

                let dateHTML;
                if (isSelected) {
                    dateHTML = `<div class="day-date">${day.date}</div>`;
                } else {
                    dateHTML = `<div class="day-date">${day.date}</div>`;
                }

                btn.innerHTML = `
                    <div class="day-name">${day.dayName}</div>
                    ${dateHTML}
                `;
                container.appendChild(btn);
            });
        }

        function scrollCalendar(dir) {
            const strip = document.getElementById('calendar-strip');
            strip.scrollBy({ left: dir * 150, behavior: 'smooth' });
        }

        function selectDate(fullDate) {
            selectedDate = fullDate;
            selectedSlots = [];
            renderCalendar();
            renderSlots();
            updateBottomBar();
        }

        // ─── Render: Squad Size ──────────────────────────────────────
        function renderSquadOptions() {
            const container = document.getElementById('squad-options');
            container.innerHTML = '';

            SQUAD_SIZES.forEach(size => {
                const pill = document.createElement('button');
                pill.className = 'squad-pill' + (selectedSquadSize === size ? ' active' : '');
                pill.textContent = size;
                pill.onclick = () => selectSquad(size);
                container.appendChild(pill);
            });

            // Update badge
            document.getElementById('squad-badge').textContent = selectedSquadSize;
        }

        function toggleSquadPanel() {
            isSquadPanelOpen = !isSquadPanelOpen;
            const panel = document.getElementById('squad-panel');
            const chevron = document.getElementById('squad-chevron');

            if (isSquadPanelOpen) {
                panel.classList.remove('hidden');
                chevron.setAttribute('data-lucide', 'chevron-up');
            } else {
                panel.classList.add('hidden');
                chevron.setAttribute('data-lucide', 'chevron-down');
            }
            lucide.createIcons();
        }

        function selectSquad(size) {
            selectedSquadSize = size;
            renderSquadOptions();
            updatePreviewHighlight();
        }

        // ─── Render: Slots Grid ──────────────────────────────────────
        function renderSlots() {
            const container = document.getElementById('slots-grid');
            container.innerHTML = '';

            let hasPartial = false;

            SLOTS.forEach(slot => {
                const isSelected = selectedSlots.includes(slot.id);
                const isPartial = slot.state === 'partial';
                const isDisabled = slot.state === 'disabled';

                if (isPartial) hasPartial = true;

                const card = document.createElement('button');
                let stateClass = slot.state;
                if (isSelected && !isPartial) stateClass = 'selected';
                if (isSelected && isPartial) stateClass = 'selected'; // partial-selected also becomes green

                card.className = 'slot-card ' + stateClass;
                card.disabled = isDisabled;
                card.onclick = () => {
                    if (!isDisabled) toggleSlotSelection(slot.id);
                };

                card.innerHTML = `
                    <div class="text-sm font-semibold">${slot.startTime} - ${slot.endTime}</div>
                    <div class="text-sm">₹${slot.price}</div>
                `;
                container.appendChild(card);
            });

            // Show/hide "Available in Other Half" section
            const otherHalf = document.getElementById('other-half-section');
            if (hasPartial) {
                otherHalf.classList.remove('hidden');
            } else {
                otherHalf.classList.add('hidden');
            }
        }

        function toggleSlotSelection(slotId) {
            if (selectedSlots.includes(slotId)) {
                selectedSlots = selectedSlots.filter(id => id !== slotId);
            } else {
                selectedSlots.push(slotId);
            }
            renderSlots();
            updateBottomBar();
        }

        // ─── Bottom Bar ──────────────────────────────────────────────
        function updateBottomBar() {
            const count = selectedSlots.length;
            const total = selectedSlots.reduce((sum, id) => {
                const slot = SLOTS.find(s => s.id === id);
                return sum + (slot ? slot.price : 0);
            }, 0);

            document.getElementById('slot-count').textContent = `${count} Slot${count !== 1 ? 's' : ''}`;
            document.getElementById('total-price').textContent = `₹${total.toLocaleString('en-IN')}`;
        }

        function handlePay() {
            if (selectedSlots.length === 0) {
                alert('Please select at least one slot.');
                return;
            }
            window.location.href = 'Checkout.html';
        }

        // ─── Modals ──────────────────────────────────────────────────
        function openModal(name) {
            document.getElementById('modal-overlay').classList.add('active');
            document.getElementById(name + '-sheet').classList.add('active');

            // If confirm, populate list
            if (name === 'confirmSlot') renderConfirmList();
            // If preferred time, render checkboxes
            if (name === 'preferredTime') renderPreferredTimeOptions();
            // If preview, update highlight
            if (name === 'preview') updatePreviewHighlight();

            lucide.createIcons();
        }

        function closeAllModals() {
            document.getElementById('modal-overlay').classList.remove('active');
            document.querySelectorAll('.bottom-sheet').forEach(el => el.classList.remove('active'));
        }

        // ─── Confirm Slot List ───────────────────────────────────────
        function renderConfirmList() {
            const container = document.getElementById('confirm-slots-list');
            container.innerHTML = '';

            if (selectedSlots.length === 0) {
                container.innerHTML = `
                    <div class="px-4 py-6 text-center">
                        <p class="text-sm" style="color: var(--text-body);">No slots selected yet.</p>
                    </div>
                `;
                return;
            }

            selectedSlots.forEach(slotId => {
                const slot = SLOTS.find(s => s.id === slotId);
                if (!slot) return;

                const row = document.createElement('div');
                row.className = 'px-4 py-3 border-b';
                row.style.borderColor = 'var(--bg-container)';
                row.innerHTML = `
                    <div class="text-sm font-medium leading-tight" style="color: var(--text-heading);">
                        ${slot.startTime} - ${slot.endTime}
                    </div>
                    <div class="text-xs mt-1" style="color: var(--text-body);">
                        ${selectedSquadSize} (Half 1) &nbsp;•&nbsp; ₹${slot.price}
                    </div>
                `;
                container.appendChild(row);
            });
        }

        // ─── Preferred Time ──────────────────────────────────────────
        function renderPreferredTimeOptions() {
            const container = document.getElementById('pref-time-options');
            container.innerHTML = '';

            PREFERRED_TIMES.forEach(pt => {
                const isChecked = preferredTimeSelections.includes(pt.label);
                const row = document.createElement('div');
                row.className = 'flex items-center gap-3 py-2 cursor-pointer';
                row.onclick = () => togglePreferredTime(pt.label);

                row.innerHTML = `
                    <div class="pref-checkbox ${isChecked ? 'checked' : ''}"></div>
                    <div class="flex-1">
                        <div class="text-sm font-medium" style="color: var(--text-heading);">${pt.label}</div>
                        <div class="text-xs" style="color: var(--text-body);">${pt.range}</div>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function togglePreferredTime(label) {
            if (preferredTimeSelections.includes(label)) {
                preferredTimeSelections = preferredTimeSelections.filter(l => l !== label);
            } else {
                preferredTimeSelections.push(label);
            }
            renderPreferredTimeOptions();
        }

        function applyPreferredTime() {
            console.log('Applied preferred time filters:', preferredTimeSelections);
            closeAllModals();
            // In a real app, you would filter SLOTS based on time ranges here
        }

        // ─── Preview Highlight ───────────────────────────────────────
        function updatePreviewHighlight() {
            const highlight = document.getElementById('preview-highlight');
            if (!highlight) return;

            let w = '100%', h = '100%', label = 'Full Turf';

            switch (selectedSquadSize) {
                case '5v5':
                    w = '50%'; h = '50%'; label = 'Quarter';
                    break;
                case '7v7':
                    w = '50%'; h = '100%'; label = 'Half';
                    break;
                case '8v8':
                    w = '75%'; h = '100%'; label = '3/4 Turf';
                    break;
                case '11v11':
                default:
                    w = '100%'; h = '100%'; label = 'Full Turf';
                    break;
            }

            highlight.style.top = '0';
            highlight.style.left = '0';
            highlight.style.width = w;
            highlight.style.height = h;

            const lbl = highlight.querySelector('div');
            if (lbl) lbl.textContent = label;
        }

        // ─── Init ────────────────────────────────────────────────────
        window.onload = () => {
            renderCalendar();
            renderSquadOptions();
            renderSlots();
            updateBottomBar();
            lucide.createIcons();
        };
    </script>

</body>
</html>
